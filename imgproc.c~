#include <stdio.h>
#include <string.h>
#include <dlfcn.h>
#include <dirent.h>

struct Plugin {
  void *handle;
  const char *(*get_plugin_name)(void);
  const char *(*get_plugin_desc)(void);
  void *(*parse_arguments)(int num_args, char *args[]);
  struct Image *(*transform_image)(struct Image *source, void *arg_data);
};

void find_files() {
  char * dir_name = "./plugins/";
  DIR * dir = opendir(dir_name);
  struct dirent * dr;
  while ((dr = readdir(dir)) != NULL) {
    char * file = dr->d_name;
    char fullpath[1000];
    snprintf(fullpath, 1000, "%s/%s", dir_name, dr->d_name);
    fullpath[999] = '\0';
    void * handle = dlopen(fullpath, RTLD_LAZY);
  }
  closedir(dir);
}

int main (int argc, char *argv[1]) {
  find_files();

  if (strcmp(argv[1], "list") == 0) {
    //list();
  } else if (strcmp(argv[1], "exec") == 0) {
    //findFiles();
  } else {
    return 1; //bad param somewhere
  }
  return 0;
}

